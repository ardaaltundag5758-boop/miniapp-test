<!DOCTYPE html>
<html lang="tr">
<head>
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval'; script-src * 'unsafe-inline' 'unsafe-eval'; connect-src * 'unsafe-inline'; img-src * data: blob: 'unsafe-inline'; frame-src *; style-src * 'unsafe-inline';">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Flashy App</title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script>
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
        }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --bg: #000000; --white: #ffffff; --gray: #888888; --nav-red: #FF3B30;
            --card: #111111; --divider: #1a1a1a;
            --rank-apprentice: #00d2ff; --rank-adept: #a445f7; --rank-master: #ffca28;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--white); font-family: 'Inter', -apple-system, sans-serif; overflow: hidden; height: 100vh; }

        /* --- ONBOARDING & SCREENS --- */
        #elite-welcome-screen, #premium-status-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--bg); z-index: 20000;
            display: flex; flex-direction: column; align-items: center;
            justify-content: space-between; padding: 60px 25px; text-align: center;
        }
        #premium-status-screen { display: none; justify-content: center; z-index: 20001; }

        .hero-center { position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .bg-flame { width: 250px; height: 250px; }
        .age-overlay { position: absolute; display: flex; flex-direction: column; align-items: center; margin-top: 10px; }
        .age-number { font-size: 5.5rem; font-weight: 900; line-height: 1; }
        
        .continue-btn { width: 100%; background: var(--white); color: #000; border: none; padding: 18px; border-radius: 16px; font-weight: 800; font-size: 1.1rem; cursor: pointer; }

        /* --- MAIN APP --- */
        #main-app { display: none; height: 100vh; overflow-y: auto; }
        
        .top-score-header { 
            background-color: #000; padding: 20px; position: relative; border-bottom: 1px solid var(--divider);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
        }
        .medal-bg { position: absolute; top: 50%; transform: translateY(-50%); width: 80px; opacity: 0.4; }
        .medal-left { left: -10px; } .medal-right { right: -10px; }
        
        .pulse-icon { color: var(--nav-red); animation: breathe 2.5s infinite ease-in-out; margin-right: 10px; }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

        .wallet-container { display: flex; justify-content: center; margin: 15px 0; }
        .connect-wallet-btn { background: #111; border: 1px solid #222; padding: 10px 20px; border-radius: 12px; font-size: 0.8rem; font-weight: 700; display: flex; align-items: center; gap: 8px; }

        .welcome-header { text-align: center; margin-bottom: 25px; }
        .avatar-main { width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--nav-red); padding: 3px; margin-bottom: 10px; }
        
        /* REWARDS SECTION */
        .score-summary-container { text-align: center; margin-bottom: 30px; }
        .main-total-points { font-size: 2.5rem; font-weight: 900; letter-spacing: -1px; margin-bottom: 15px; }
        
        .stats-grid { display: flex; justify-content: space-around; padding: 0 10px; }
        .stat-item { display: flex; flex-direction: column; align-items: center; }
        .stat-label { color: var(--gray); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 5px; }
        .stat-value { font-size: 1.1rem; font-weight: 800; color: #fff; }

        .stat-box { background: var(--card); border-radius: 18px; padding: 20px; display: flex; justify-content: space-between; align-items: center; margin: 0 20px 10px; }
    </style>
</head>
<body>

<div id="elite-welcome-screen">
    <div style="font-size: 1.1rem;">You've joined Telegram</div>
    <div class="hero-center">
        <img class="bg-flame" src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Animals%20and%20Nature/Fire.webp?raw=true">
        <div class="age-overlay">
            <span class="age-number" id="wel-age-num">0</span>
            <span style="font-size:1.4rem; font-weight:700;">years ago</span>
        </div>
    </div>
    <div class="footer-info">
        <div style="color:var(--gray); margin-bottom:10px;">Your account number is <span id="wel-user-id" style="color:#fff;">#0</span></div>
        <div id="top-rank-text" style="font-weight:600;">You're in the Top 0% ðŸ”¥</div>
    </div>
    <button class="continue-btn" onclick="startAfterElite()">Continue</button>
</div>

<div id="premium-status-screen">
    <div id="prem-icon" style="font-size:4rem; margin-bottom:20px;">ðŸŒŸ</div>
    <div id="prem-msg" style="font-size:1.2rem; font-weight:600; margin-bottom:30px;"></div>
    <button onclick="finishIntro()" class="continue-btn">Finish</button>
</div>

<div id="main-app">
    <div class="top-score-header" onclick="resetDemo()">
        <img class="medal-bg medal-left" src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Activity/1st%20Place%20Medal.webp?raw=true">
        <img class="medal-bg medal-right" src="https://github.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/blob/main/Activity/1st%20Place%20Medal.webp?raw=true">
        <div style="font-weight:800;"><i class="fas fa-play pulse-icon"></i>Your Score</div>
    </div>

    <div class="wallet-container">
        <div class="connect-wallet-btn"><i class="fas fa-wallet"></i>Connect Wallet</div>
    </div>

    <div class="welcome-header">
        <img id="u-pic" class="avatar-main" src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
        <h2 id="u-name">User</h2>
    </div>

    <div class="score-summary-container">
        <div class="main-total-points" id="display-total-points">0 FLSY</div>
        
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-label">Rewards</span>
                <span class="stat-value" id="val-rewards">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Tasks</span>
                <span class="stat-value">+0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Invites</span>
                <span class="stat-value">+0</span>
            </div>
        </div>
    </div>

    <div class="stat-box">
        <div><div style="color:var(--gray); font-size:0.8rem;">Account Age</div><div id="acc-age" style="font-weight:700;">... years</div></div>
        <i class="fas fa-calendar-alt" style="color:var(--nav-red); font-size:1.2rem;"></i>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;

    // 1. FORMATLAYICI FONKSÄ°YON (k, M, B)
    function formatPoints(num) {
        if (num >= 1000000000) return (num / 1000000000).toFixed(1).replace(/\.0$/, '') + 'B';
        if (num >= 1000000) return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
        if (num >= 1000) return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
        return num.toString();
    }

    let userState = {
        age: 0,
        id: 0,
        rewards: 0,
        isPremium: false
    };

    function init() {
        const tgUser = tg.initDataUnsafe.user || { id: 582145000, first_name: "Guest", is_premium: false };
        userState.id = tgUser.id;
        userState.isPremium = tgUser.is_premium || false;

        // 2. PUAN HESAPLAMA (YaÅŸa gÃ¶re)
        userState.age = userState.id < 100000000 ? 11 : (userState.id < 1000000000 ? 6 : 2);
        
        // KALICI VERÄ° OKUMA: EÄŸer daha Ã¶nce kaydedilmemiÅŸse hesapla ve kaydet
        let savedRewards = localStorage.getItem('user_rewards');
        
        if (savedRewards) {
            userState.rewards = parseInt(savedRewards);
        } else {
            // Ä°lk hesaplama: YaÅŸ puanÄ± + (varsa) Premium bonusu
            userState.rewards = (userState.age * 450) + (userState.isPremium ? 1000 : 0);
            localStorage.setItem('user_rewards', userState.rewards);
        }

        updateUI(tgUser);

        if (localStorage.getItem('onboarding_complete')) showMain();
    }

    function updateUI(tgUser) {
        // GiriÅŸ ekranÄ± verileri
        document.getElementById('wel-age-num').innerText = userState.age;
        document.getElementById('wel-user-id').innerText = "#" + userState.id;
        let percent = userState.id < 100000000 ? 1 : (userState.id < 1000000000 ? 12 : 35);
        document.getElementById('top-rank-text').innerText = `You're in the Top ${percent}% ðŸ”¥`;

        // Ana uygulama verileri (FORMATLI)
        document.getElementById('u-name').innerText = tgUser.first_name;
        document.getElementById('acc-age').innerText = userState.age + " Years";
        
        // Rewards kÄ±smÄ±nda kÄ±saltÄ±lmÄ±ÅŸ hali gÃ¶ster
        document.getElementById('display-total-points').innerText = formatPoints(userState.rewards) + " FLSY";
        document.getElementById('val-rewards').innerText = "+" + formatPoints(userState.rewards);

        if(tgUser.photo_url) document.getElementById('u-pic').src = tgUser.photo_url;
    }

    function startAfterElite() {
        document.getElementById('elite-welcome-screen').style.display = 'none';
        const msg = userState.isPremium ? 
            "Premium detected! +1.0k FLSY added to your rewards." : 
            "No Premium found. Standard age rewards applied.";
        document.getElementById('prem-msg').innerText = msg;
        document.getElementById('premium-status-screen').style.display = 'flex';
    }

    function finishIntro() {
        localStorage.setItem('onboarding_complete', 'true');
        showMain();
    }

    function showMain() {
        document.getElementById('elite-welcome-screen').style.display = 'none';
        document.getElementById('premium-status-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
    }

    function resetDemo() {
        localStorage.clear();
        location.reload();
    }

    window.onload = init;
</script>
</body>
</html>
